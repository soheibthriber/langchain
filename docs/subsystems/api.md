# API Subsystem Requirements (FastAPI)

## Scope
Provide local endpoints to serve and execute lessons, returning GraphJSON for the viewer. Not intended for public hosting in this repo.

## Endpoints
- GET /api/runs/{lesson_id}/latest
  - Reads lessons/{lesson_id}/graph.json and returns it.
  - 404 if missing; JSON error on failure.

- POST /api/run/{lesson_id}
  - Body: { "text"?: string }
  - Executes lessons/{lesson_id}/code.py to regenerate graph.json; returns GraphJSON.
  - Validate lesson directories exist; catch exceptions and return JSON error.

- GET /api/lessons
  - Returns a list of available lesson IDs (directory names).

- GET /api/mermaid/{lesson_id}
  - Returns Mermaid flowchart (generated by viz/mermaid.py) for the latest graph.

## Behavior
- Load .env for provider keys used by lesson code.
- CORS enabled for dev viewer (localhost:3000/3001).
- Always return JSON for errors; avoid blocking.

## Contract
- Response is GraphJSON v1.1 as defined in docs/PRD.md.
- Lessons must output graph.json to their own folder.

## Dev
- Start: `python3 -m uvicorn api.main:app --reload --host 127.0.0.1 --port 8000`.

## Future
- Run history: `/api/runs/{lesson_id}` returns list of past run IDs.
- Health endpoints and versioning.
